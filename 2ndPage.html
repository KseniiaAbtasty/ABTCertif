<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>AB Tasty Cerification</title>
  <script type="text/javascript" src="https://try.abtasty.com/2247504501e9ca2e4473281fcbb8c8d8.js"></script>
  <script> 
    const tid1=Math.floor(Math.random() * Math.floor(10000));
    window.abtasty.send("transaction", { 
      tid: "OD564"+tid1, // Format: STRING, value example: "OD564" 
      ta: "Exemple transaction", // Format: STRING, value example: "Purchase" 
      tr: 12.44, // Format: FLOAT, value example: 15.47 
      ts: 0, // Format: FLOAT, value example: 3.5 
      tt: 1, // Format: FLOAT, value example: 2.60  
      tc: "EUR", // Format: STRING, value example: "EUR"   
      tcc: "None", // Format: STRING, value example: "Coupon" 
      pm: "Credit Card", // Format: STRING, value example: "Paypal" 
      sm: "Chronopost", // Format: STRING, value example: "Fedex" 
      icn: 2 // Format: INTEGER, value example: 12 
    }); 

    if (Array.isArray(JSON.parse(localStorage.getItem('transactions'))) === true) { 
      for (var i = 0; i < JSON.parse(localStorage.getItem('transactions')).length; i++) { 
        window.abtasty.send("item", { 
          "tid": "OD564"+tid1, // Format: STRING, value example: "OD564" 
          "in": "NAME", // Format: STRING, value example: "Shoe" 
          "ip": 12.55, // Format: FLOAT, value example: 3.5 
          "iq": 2, // Format: INTEGER, value example: 4 
          "ic": "SKU111", // Format: STRING, value example: "SKU47" 
          "iv": "CATEGORY" // Format: STRING, value example: "Blue" 
        }); 
      } 
    } 

   fetch("https://decision.flagship.io/v2/bt8f6o9k85v039namjhg/campaigns", 
     {
      method: 'POST', 
      headers: {"x-api-key": "mGubkybkKw4G9weE7ALZAaNv8DdAhWEn3Wfyhh59" },
      body: JSON.stringify({visitor_id: "dpkj8t452hf0w0de"})
     }
   ).then(response => response.json())
  .then(data => {
    if (data.campaigns && data.campaigns.indexOf("btmc2q409hdg4m00llig") > -1){
      if (!data.campaigns["btmc2q409hdg4m00llig"].variation.modifications.value.imageBonusFlag) document.querySelector('button').style.background='green';
      

      // SEND EVENT
      fetch("https://ariane.abtasty.com", {
	method: "POST",
    	header: "content-type: application/json",
  	body: JSON.stringify({
		"cid": "btmcjec09hdg5j1b0drg",
       		"dl": "http://saievych.dev",
  		"ea": "newsletterSubscription",
  		"ec": "Action Tracking",
  		"el": "option",
  		"ev": 1,
  		"t": "EVENT",
  		"vid": "dpkj8t452hf0w0de",
  		"ds": "APP"})
        });

	// SEND TRANSACTION
       fetch("https://ariane.abtasty.com", {
	method: "POST",
    	header: "content-type: application/json",
  	body: JSON.stringify({
		"cid": "btmcjec09hdg5j1b0drg",
  		"icn": 12,
 		 "pm": "Paypal",
 		 "sm": "Fedex",
 		 "t": "TRANSACTION",
 		 "ta": "Purchase",
 		 "tc": "EUR",
 		 "tcc": "Coupon",
 		 "tid": "transaction"+Math.floor(Math.random() * Math.floor(10000)),
  		 "tr": 15.47,
  		 "ts": 3.5,
 		 "tt": 2.6,
 		 "vid": "dpkj8t452hf0w0de",
 		 "ds": "APP"
	})
        });

      }
    }
  );
  </script>
</head>
<body>
  <h1>Second page</h1>
  <button onclick="location.href = '/';">Go to first</button>
</body>
</html>
